<p-toast key="campus"></p-toast>

<div class="grid">
    <div class="col-12 sm:col-12 md:col-12 lg:col-12 xl:col-12">
        <app-card 
            header="Mantenedor de campus"
            subheader="Permite ver, crear y actualizar campus."
        >

            <app-menu-buttons-table
                (clickOpenNew)="openNew()"
            ></app-menu-buttons-table>

            

            <p-table
                #tc
                [value]="campuses"
                [columns]="cols"
                [rows]="10"
                [globalFilterFields]="['nombre','estado']"
                [paginator]="false" 
                [rowsPerPageOptions]="[10,25,50]"
                [showCurrentPageReport]="true" 
                currentPageReportTemplate="{first} hasta {last} de {totalRecords} registros."
                [(selection)]="selectedCampus" 
                selectionMode="multiple" 
                [rowHover]="true" 
                dataKey="id"
            >
                <ng-template pTemplate="caption">
                    <div class="flex justify-content-between align-content-center">
                        <div>
                            <span class="p-input-icon-left">
                                <i class="pi pi-search"></i>
                                <input pInputText type="text" (input)="onGlobalFilter(tc, $event)" placeholder="Buscar..."  />
                            </span>
                            <p-button
                                styleClass="p-button-text p-button-sm ml-2"
                                icon="pi pi-filter-slash"
                                pTooltip="Limpiar filtros"
                                (click)="tc.clear()"
                            ></p-button>
                        </div>
                        <div>
                            <!-- <p-button
                            styleClass="p-button-danger p-button-sm mr-2"
                            icon="pi pi-file-pdf"
                            label="Descargar"
                            >
                            </p-button> -->
                            <p-button
                            pRipple
                            label="Actualizar"
                            icon="pi pi-refresh"
                            styleClass="p-button-sm p-button-info"
                            (click)="refreshTable()"
                            ></p-button>
                        </div>
                        
                    </div>
                </ng-template>

                <ng-template pTemplate="header">
                    <tr>
                        <th style="width: 3rem">
                            <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
                        </th>
                        <th pSortableColumn="nombre">Nombre <p-sortIcon field="nombre"></p-sortIcon></th>
                        <th pSortableColumn="estado">Estado <p-sortIcon field="estado"></p-sortIcon></th>
                        <th style="min-width: 10rem">Acciones</th>
                    </tr>
                </ng-template>

                <ng-template pTemplate="body" let-campus >
                    <tr>
                        <td>
                            <p-tableCheckbox [value]="campus"></p-tableCheckbox>
                        </td>
                        <td style="width:50%; min-width:10rem;">
                            <span class="p-column-title">Nombre</span>
                            {{campus.nombre}}
                        </td>

                        <td style="width:50%; min-width:10rem;">
                            <span class="p-column-title">Estado</span>
                            <span [class]="'estado-badge estado-' + (campus.estado ? campus.estado.toLowerCase() : '')">
                                {{campus.estado}}
                            </span>
                        </td>
                        <td>
                            <div class="flex">
                                <p-button
                                    icon="pi pi-trash"
                                    styleClass="p-button-sm p-button-danger mr-2"
                                    pTooltip="Eliminar registro"
                                ></p-button>
                                <p-button
                                    icon="pi pi-pencil"
                                    styleClass="p-button-sm p-button-warning mr-2"
                                    pTooltip="Editar registro"
                                ></p-button>

                            </div>
                        </td>
                    </tr>
                </ng-template>
            </p-table> 

        </app-card>

        <app-dialog [(visible)]="dialog">
            
            <div header>
                <ng-container [ngSwitch]="mode">

                    <ng-container *ngSwitchCase="'create'">
                        <span class="text-xl">Agregar campus</span>
                    </ng-container>

                    <ng-container *ngSwitchCase="'edit'">
                        <span class="text-xl">Actualizar campus</span>
                    </ng-container>

                </ng-container>
            </div>

            <div content>
                <form [formGroup]="fbForm">
                    <div class="grid">
                        <div class="col-12 sm:col-12 md:col-12 lg:col-12 xl:col-12">
                            <app-form-isvalid [valid]="fbForm.valid"></app-form-isvalid>
                        </div>

                        <div class="col-12 sm:col-12 md:col-12 lg:col-12 xl:col-12">
                            <div class="field">
                                <label>Nombre *</label>
                                <input type="text" pInputText formControlName="nombre" class="w-full" />
                                <app-form-control
                                [control]="fbForm.controls['nombre']"
                                [validators]="['required']"
                                ></app-form-control>
                            </div>
                        </div>
                    </div>
                </form>

                <app-uploader-files 
                    [data]="campus" 
                    [extrasDocs]="extrasDocs"
                    (filesChange)="filesChanged($event)"
                    (saveDoc)="saveDoc($event)" 
                ></app-uploader-files>
                
            </div>

            <div footer>
                <p-button
                label="Cerrar"
                icon="pi pi-times"
                styleClass="p-button-sm p-button-secondary mr-2"
                (click)="dialog = false"
                [text]="true"
                ></p-button>
                <p-button
                label="Agregar"
                icon="pi pi-check"
                styleClass="mr-2 p-button-success p-button-sm"
                [disabled]="!fbForm.valid"
                (click)="dialog = false && fbForm.valid && submit()"
                ></p-button>
            </div>
            
            

        </app-dialog>

    </div>
</div>

